import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";

export component VexSelector inherits Window {
    width: 480px;
    height: 240px;
    title: "vex autonomous selector";

    in-out property <bool> is_red_alliance: true;
    in-out property <int> selected_route: 0;
    in-out property <[string]> routes: ["Top", "Bottom", "Skills", "Test"]; // default until set from rust
    in-out property <bool> show_progress: false;
    in-out property <float> progress_value: 0.0; // 0.0 to 100.0
    in-out property <string> progress_text: "Calibrating IMU...";
    callback route_selected(index: int);
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #0f172a;
    }

    HorizontalBox {
        spacing: 0px;
        padding: 0px;

        // left panel - selector
        Rectangle {
            width: 240px;
            
            VerticalBox {
                padding: 0px;
                spacing: 0px;
                alignment: start;

                // alliance toggle
                VerticalBox {
                    spacing: 0px;
                    alignment: LayoutAlignment.start;
                    height: 48px;

                    HorizontalBox {
                        spacing: 8px;
                        alignment: LayoutAlignment.start;

                        Text {
                            text: is_red_alliance ? "RED" : "BLUE";
                            min-width: 32px;
                            horizontal-alignment: TextHorizontalAlignment.left;
                            vertical-alignment: TextVerticalAlignment.center;
                            color: is_red_alliance ? #ef4444 : #3b82f6;
                            font-size: 12px;
                            font-weight: 600;
                        }

                        Rectangle {
                            width: 40px;
                            height: 20px;
                            background: is_red_alliance ? #ef4444 : #3b82f6;
                            border-radius: 10px;
                            
                            Rectangle {
                                width: 18px;
                                height: 18px;
                                background: #f8fafc;
                                border-radius: 9px;
                                x: is_red_alliance ? 20px : 2px;
                                y: 1px;
                                
                                animate x {
                                    duration: 100ms;
                                    easing: ease-out;
                                }
                            }

                            TouchArea {
                                clicked => {
                                    is_red_alliance = !is_red_alliance;
                                }
                            }
                        }
                    }
                }

                // route buttons
                VerticalBox {
                    spacing: 6px;
                    alignment: start;

                    for route[idx] in routes : Rectangle {
                        height: 36px;
                        background: selected_route == idx ? #334155 : #1e293b;
                        border-radius: 8px;
                        border-width: 1px;
                        border-color: selected_route == idx ? #475569 : #334155;

                        animate background {
                            duration: 150ms;
                        }

                        HorizontalBox {
                            padding-left: 8px;
                            padding-right: 8px;
                            alignment: center;

                            Text {
                                text: route;
                                color: selected_route == idx ? #f8fafc : #cbd5e1;
                                font-size: 10px;
                                font-weight: 500;
                            }
                        }

                        TouchArea {
                            clicked => {
                                selected_route = idx;
                                route_selected(idx);
                            }
                        }
                    }
                }
            }
        }

        // right panel - field preview
        Rectangle {
            border-width: 1px;
            border-color: #334155;
            VerticalBox {
                padding: 0px;
                alignment: start;

                Image {
                    width: 240px;
                    height: 240px;
                    // source: @image-url("field_preview.png");
                    image-fit: contain;
                }
            }
        }
    }
    if show_progress : Rectangle {
        width: parent.width;
        height: parent.height;
        background: rgba(0, 0, 0, 0.7); // semi-transparent overlay
        
        Rectangle {
            width: 280px;
            height: 80px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: #1e293b;
            border-radius: 12px;
            border-width: 1px;
            border-color: #334155;

            TouchArea {
                width: 480px;
                height: 240px;
                clicked => {
                    // consume clicks to prevent interaction with underlying UI
                }
            }

            VerticalBox {
                padding: 16px;
                spacing: 12px;
                alignment: center;
                
                Text {
                    text: progress_text;
                    color: #f8fafc;
                    font-size: 11px;
                    horizontal-alignment: center;
                }
                
                Rectangle {
                    width: parent.width - 32px;
                    height: 6px;
                    background: #334155;
                    border-radius: 3px;
                    HorizontalBox {
                        padding: 0px;
                        spacing: 0px;
                        alignment: start;
                        Rectangle {
                            width: parent.width * (progress_value / 100.0);
                            height: parent.height;
                            background: #3b82f6;
                            border-radius: 3px;
                        
                        }
                    }
                }
            }
        }
    }
}

export component MainWindow inherits Window {
    VexSelector { }
}
