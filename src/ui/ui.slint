import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import "./JetBrainsMono-Regular.ttf";
export component VexSelector inherits Window {
    width: 480px;
    height: 240px;
    title: "vex autonomous selector";

    in-out property <bool> is_red_alliance: true;
    in-out property <int> selected_route: 0;
    in-out property <[string]> routes: ["Top", "Bottom", "Skills", "Test"]; // default until set from rust
    in-out property <bool> show_progress: false;
    in-out property <float> progress_value: 0.0; // 0.0 to 100.0
    in-out property <string> progress_text: "Calibrating IMU...";
    in-out property <bool> diagnostics_visible: true;

    in-out property <float> pose_x: 0.0;
    in-out property <float> pose_y: 0.0;
    in-out property <float> heading: 0.0;
    in-out property <float> battery_percentage: 85.0;
    in-out property <float> battery_voltage: 12.8; // nominal voltage

    // individual motor temperatures (avoid dynamic allocations)
    in-out property <float> left_motor_temp_1: 30.0;
    in-out property <float> left_motor_temp_2: 55.0;
    in-out property <float> left_motor_temp_3: 65.0;
    in-out property <float> right_motor_temp_1: 45.0;
    in-out property <float> right_motor_temp_2: 50.0;
    in-out property <float> right_motor_temp_3: 60.0;
    in-out property <float> intake_motor_temp_1: 25.0;
    in-out property <float> intake_motor_temp_2: 55.0;
    in-out property <float> intake_motor_temp_3: 40.0;
    
    callback route_selected(index: int);
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #0f172a;
    }

    HorizontalBox {
        spacing: 0px;
        padding: 0px;

        // left panel - selector
        Rectangle {
            width: 240px;
            
            VerticalBox {
                padding: 0px;
                spacing: 0px;
                alignment: start;

                // alliance toggle
                HorizontalBox {
                    spacing: 0px;
                    visible: true;
                    padding: 8px;
                    alignment: LayoutAlignment.space-between;
                    height: 40px;

                    Rectangle {
                        width: 56px;
                        height: 32px;
                        background: is_red_alliance ? #ef4444 : #3b82f6;
                        border-radius: 16px;

                        Rectangle {
                            width: 28px;
                            height: 28px;
                            background: #f8fafc;
                            border-radius: 14px;
                            x: is_red_alliance ? 26px : 2px;
                            y: 2px;

                            animate x {
                                duration: 100ms;
                                easing: ease-out;
                            }
                        }

                        TouchArea {
                            clicked => {
                                is_red_alliance = !is_red_alliance;
                            }
                        }
                    }
                    Rectangle {
                        width: 32px;
                        height: 32px;
                        background: diagnostics_visible ? #475569 : #1e293b;
                        border-radius: 6px;
                        border-width: 1px;
                        border-color: diagnostics_visible ? #64748b : #334155;

                        animate background {
                            duration: 150ms;
                        }

                        Image {
                            source: @image-url("activity.svg");
                            colorize: #f8fafc;
                            width: 20px;
                            height: 20px;
                            x: (parent.width - self.width) / 2;
                            y: (parent.height - self.height) / 2;
                        }

                        TouchArea {
                            clicked => {
                                diagnostics_visible = !diagnostics_visible;
                            }
                        }
                    }
                }

                // route buttons
                VerticalBox {
                    spacing: 6px;
                    padding: 8px;
                    alignment: start;

                    for route[idx] in routes : Rectangle {
                        height: 36px;
                        background: selected_route == idx ? #334155 : #1e293b;
                        border-radius: 8px;
                        border-width: 1px;
                        border-color: selected_route == idx ? #475569 : #334155;

                        animate background {
                            duration: 150ms;
                        }

                        HorizontalBox {
                            padding-left: 8px;
                            padding-right: 8px;
                            alignment: center;

                            Text {
                                text: route;
                                color: selected_route == idx ? #f8fafc : #cbd5e1;
                                font-size: 10px;
                                font-weight: 500;
                                font-family: "JetBrains Mono";
                            }
                        }

                        TouchArea {
                            clicked => {
                                selected_route = idx;
                                route_selected(idx);
                            }
                        }
                    }
                }
            }
        }

        // right panel - field preview or diagnostics
        Rectangle {
            VerticalBox {
                spacing: 0px;
                padding: 0px;
                alignment: start;

                Image {
                    width: diagnostics_visible ? 0px : 240px;
                    height: diagnostics_visible ? 0px : 240px;
                    source: @image-url("cabbit.png");
                    image-fit: contain;
                }

                Rectangle {
                    visible: diagnostics_visible;
                    width: diagnostics_visible ? 240px : 0px;
                    height: diagnostics_visible ? 240px : 0px;
                    
                    VerticalBox {
                        spacing: 0px;
                        padding-bottom: 0px;
                        alignment: start;
                        
                        Text {
                            text: "DIAGNOSTICS";
                            color: #f8fafc;
                            font-size: 14px;
                            font-weight: 700;
                            font-family: "JetBrains Mono";
                            horizontal-alignment: TextHorizontalAlignment.left;
                        }
                        
                        VerticalBox {
                            spacing: 0px;
                            padding-bottom: 0px;
                            alignment: start;
                            
                            Text {
                                text: "POSE";
                                color: #94a3b8;
                                font-size: 11px;
                                font-weight: 600;
                                font-family: "JetBrains Mono";
                            }
                            
                            HorizontalBox {
                                spacing: 0px;
                                padding: 0px;
                                Text {
                                    text: "X: " + Math.round(pose_x * 100) / 100 + "\"";
                                    color: #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                }
                                Text {
                                    text: "Y: " + Math.round(pose_y * 100) / 100 + "\"";
                                    color: #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                }
                                Text {
                                    text: "θ: " + Math.round(heading * 10) / 10 + "°";
                                    color: #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                }
                            }
                        }
                        VerticalBox {
                            spacing: 0px;
                            padding-bottom: 0px;
                            alignment: start;
                            
                            Text {
                                text: "STATUS";
                                color: #94a3b8;
                                font-size: 11px;
                                font-weight: 600;
                                font-family: "JetBrains Mono";
                            }
                            
                            Text {
                                text: "VOLTAGE: " + Math.round(battery_voltage * 10) / 10 + "V";
                                color: (battery_voltage < 12.6 || battery_voltage > 12.9) ? #ef4444 : #e2e8f0;
                                font-size: 11px;
                                font-family: "JetBrains Mono";
                            }
                            
                            Text {
                                text: "BATTERY: " + Math.round(battery_percentage * 10) / 10 + "%";
                                color: battery_percentage < 20 ? #ef4444 : #e2e8f0;
                                font-size: 11px;
                                font-family: "JetBrains Mono";
                            }
                        }
                        
                        VerticalBox {
                            spacing: 2px;
                            padding-bottom: 0px;
                            alignment: start;
                            
                            Text {
                                text: "MOTOR TEMPS (°C)";
                                color: #94a3b8;
                                font-size: 11px;
                                font-weight: 600;
                                font-family: "JetBrains Mono";
                            }
                            
                            HorizontalBox {
                                spacing: 0px;
                                padding: 0px;
                                Text {
                                    text: "L:";
                                    color: #94a3b8;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 12px;
                                }
                                Text {
                                    text: left_motor_temp_1;
                                    color: left_motor_temp_1 >= 65 ? #ef4444
                                        : left_motor_temp_1 >= 60 ? #f59e42
                                        : left_motor_temp_1 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: left_motor_temp_2;
                                    color: left_motor_temp_2 >= 65 ? #ef4444
                                        : left_motor_temp_2 >= 60 ? #f59e42
                                        : left_motor_temp_2 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: left_motor_temp_3;
                                    color: left_motor_temp_3 >= 65 ? #ef4444
                                        : left_motor_temp_3 >= 60 ? #f59e42
                                        : left_motor_temp_3 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                            }

                            HorizontalBox {
                                spacing: 0px;
                                padding: 0px;
                                Text {
                                    text: "R:";
                                    color: #94a3b8;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 12px;
                                }
                                Text {
                                    text: right_motor_temp_1;
                                    color: right_motor_temp_1 >= 65 ? #ef4444
                                        : right_motor_temp_1 >= 60 ? #f59e42
                                        : right_motor_temp_1 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: right_motor_temp_2;
                                    color: right_motor_temp_2 >= 65 ? #ef4444
                                        : right_motor_temp_2 >= 60 ? #f59e42
                                        : right_motor_temp_2 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: right_motor_temp_3;
                                    color: right_motor_temp_3 >= 65 ? #ef4444
                                        : right_motor_temp_3 >= 60 ? #f59e42
                                        : right_motor_temp_3 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                            }
                            
                            HorizontalBox {
                                spacing: 0px;
                                padding: 0px;
                                Text {
                                    text: "I:";
                                    color: #94a3b8;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 12px;
                                }
                                Text {
                                    text: intake_motor_temp_1;
                                    color: intake_motor_temp_1 >= 65 ? #ef4444
                                        : intake_motor_temp_1 >= 60 ? #f59e42
                                        : intake_motor_temp_1 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: intake_motor_temp_2;
                                    color: intake_motor_temp_2 >= 65 ? #ef4444
                                        : intake_motor_temp_2 >= 60 ? #f59e42
                                        : intake_motor_temp_2 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                                Text {
                                    text: intake_motor_temp_3;
                                    color: intake_motor_temp_3 >= 65 ? #ef4444
                                        : intake_motor_temp_3 >= 60 ? #f59e42
                                        : intake_motor_temp_3 >= 55 ? #fde047
                                        : #e2e8f0;
                                    font-size: 11px;
                                    font-family: "JetBrains Mono";
                                    min-width: 24px;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    if show_progress : Rectangle {
        width: parent.width;
        height: parent.height;
        background: rgba(0, 0, 0, 0.7); // semi-transparent overlay
        
        Rectangle {
            width: 280px;
            height: 80px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: #1e293b;
            border-radius: 12px;
            border-width: 1px;
            border-color: #334155;

            TouchArea {
                width: 480px;
                height: 240px;
                clicked => {
                    // consume clicks to prevent interaction with underlying UI
                }
            }

            VerticalBox {
                padding: 16px;
                spacing: 12px;
                alignment: center;
                
                Text {
                    text: progress_text;
                    color: #f8fafc;
                    font-size: 11px;
                    horizontal-alignment: center;
                    font-family: "JetBrains Mono";
                }
                
                Rectangle {
                    width: parent.width - 32px;
                    height: 6px;
                    background: #334155;
                    border-radius: 3px;
                    HorizontalBox {
                        padding: 0px;
                        spacing: 0px;
                        alignment: start;
                        Rectangle {
                            width: parent.width * (progress_value / 100.0);
                            height: parent.height;
                            background: #3b82f6;
                            border-radius: 3px;
                        }
                    }
                }
            }
        }
    }
}

export component MainWindow inherits Window {
    VexSelector { }
}
